!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,r){if(t){if("string"==typeof t)return e(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=new(function(){var e;function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.initialState=e,this.board=e.map(function(e){return t(e)}),this.score=0,this.isGameStarted=!1}return e=[{key:"move",value:function(e){var t=this,r="left"===e||"right"===e,n="right"===e||"down"===e,o=r?this.board:this.transpose(this.board);o=o.map(function(e){var r=(n?e.slice().reverse():e).filter(function(e){return 0!==e}),o=t.joinValues(r,e.length);return n?o.reverse():o}),this.board=r?o:this.transpose(o)}},{key:"moveLeft",value:function(){this.move("left")}},{key:"moveRight",value:function(){this.move("right")}},{key:"moveUp",value:function(){this.move("up")}},{key:"moveDown",value:function(){this.move("down")}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.board.map(function(e){return t(e)})}},{key:"getStatus",value:function(){return this.isGameStarted?this.board.some(function(e){return e.some(function(e){return 2048===e})})?"win":this.checkAvailableMoves()?"playing":"lose":"idle"}},{key:"start",value:function(){var e=this.getRandomCell(2),t=this.addNewCell(e);return this.isGameStarted=!0,t}},{key:"restart",value:function(){this.board=this.initialState.map(function(e){return t(e)}),this.score=0,this.isGameStarted=!1}},{key:"getRandomCell",value:function(e){for(var t=this.getState(),r=[],n=0;n<t.length;n++)for(var o=0;o<t[n].length;o++)0===t[n][o]&&r.push({row:n,col:o});for(var a=Math.min(e,r.length),i=[];i.length<a;){var s=Math.floor(Math.random()*r.length);i.push(r[s]),r.splice(s,1)}return i}},{key:"addNewCell",value:function(e){var t=[],r=!0,n=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,l=s.row,u=s.col;this.board[l][u]=.9>Math.random()?2:4,t.push({row:l,col:u,value:this.board[l][u]})}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return t}},{key:"checkAvailableMoves",value:function(){var e=this.board.some(function(e){return e.some(function(e){return 0===e})}),t=this.board.some(function(e){return e.some(function(t,r){return t===e[r+1]})}),r=this.transpose(this.board).some(function(e){return e.some(function(t,r){return t===e[r+1]})});return e||t||r}},{key:"joinValues",value:function(e,t){for(var r=[],n=0,o=0;o<e.length;o++)if(e[o]===e[o+1]){var a=2*e[o];r.push(a),n+=a,o++}else r.push(e[o]);for(;r.length<t;)r.push(0);return this.score+=n,r}},{key:"isBoardChanged",value:function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)if(e[r][n]!==t[r][n])return!0;return!1}},{key:"transpose",value:function(e){return e[0].map(function(t,r){return e.map(function(e){return e[r]})})}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,e),r}()),n=Array.from(document.querySelectorAll(".field-row")).map(function(e){return Array.from(e.querySelectorAll(".field-cell"))}),o=document.querySelector(".message-lose"),a=document.querySelector(".message-win");document.addEventListener("keydown",function(e){var t=r.getState();if("playing"===r.getStatus()){switch(e.key){case"ArrowUp":r.moveUp();break;case"ArrowDown":r.moveDown();break;case"ArrowLeft":r.moveLeft();break;case"ArrowRight":r.moveRight()}if(r.isBoardChanged(t,r.board)){var i=r.addNewCell(r.getRandomCell(1));l(r,n,"new",i)}"win"===r.getStatus()&&a.classList.remove("hidden"),"lose"===r.getStatus()&&o.classList.remove("hidden")}});var i=document.querySelector(".message-start"),s=document.querySelector(".controls .button");function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];e.getState().forEach(function(e,o){e.forEach(function(e,a){var i=t[o][a];i.textContent=0===e?"":e,i.className="field-cell",0!==e&&i.classList.add("field-cell--".concat(e)),"new"===r&&n.some(function(e){return e.row===o&&e.col===a})&&i.classList.add("field-cell--new"),i.addEventListener("animationend",function(){i.classList.remove("field-cell--new","field-cell--move")},{once:!0})})});var o=e.getScore();document.querySelector(".game-score").textContent=o}s.addEventListener("click",function(){if(s.classList.contains("start")){var e=r.start();l(r,n,"new",e),i.classList.add("hidden"),s.textContent="Restart"}s.classList.contains("restart")&&(r.restart(),l(r,n),i.classList.remove("hidden"),a.classList.add("hidden"),o.classList.add("hidden"),s.textContent="Start"),s.classList.toggle("start"),s.classList.toggle("restart")})}();
//# sourceMappingURL=index.051cc304.js.map
